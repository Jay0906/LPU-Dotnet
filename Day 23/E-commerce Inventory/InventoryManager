using System;
using System.Collections.Generic;
namespace E_commerceInventorySystem;
public class InventoryManager
{
    // TODO:
    // Create method that accepts any IProduct collection
    public void ProcessProducts<T>(IEnumerable<T> products) where T : IProduct
    {
        // a) Print all product names and prices
        // b) Find the most expensive product
        // c) Group products by category
        // d) Apply 10% discount to Electronics over $500
        
        System.Console.WriteLine("All Prodcucts: ");
        foreach(var item in products)
        {
            System.Console.WriteLine($"{item.Name} - {item.Price}");
        }

        var exp=products.OrderByDescending(n=>n.Price).FirstOrDefault();
        System.Console.WriteLine($"Most Expensice Products:{exp.Name} - {exp.Price}");

        var cat=products.GroupBy(n=>n.Category);
        foreach(var item in cat)
        {
            System.Console.WriteLine($"{item.Key} - {item.Count()}");
        }

        var dis=products.Where(n=>n.Category==Category.Electronics && n.Price>500).Select(p=>new {p.Name,OriginalPrice=p.Price,DiscountPrice=((p.Price*10)*100)});
        foreach(var item in dis)
        {
            System.Console.WriteLine($"{item.Name} - {item.OriginalPrice} - {item.DiscountPrice}");
        }
    }

    // TODO:
    // Implement bulk price update with delegate
    public void UpdatePrices<T>(List<T> products, Func<T, decimal> priceAdjuster)
        where T : IProduct
    {
        // Apply priceAdjuster to each product
        // Handle exceptions gracefully
        if (products == null)
        {
            throw new ArgumentNullException(nameof(products));
        }

        if (priceAdjuster == null)
        {
            throw new ArgumentException(nameof(priceAdjuster));
        }

        foreach(var product in products){
            try
            {
                decimal newPrice=priceAdjuster(product);
                if (newPrice < 0)
                {
                    throw new InvalidOperationException(nameof(newPrice));
                }

                var property=product.GetType().GetProperty("Price");
                if(property!=null && property.CanWrite)
                {
                    property.SetValue(product,newPrice);
                }
            }
            catch(Exception ex)
            {
                System.Console.WriteLine($"Error Updating {product.Name}: {ex.Message}");
            }
        }
    }
}
